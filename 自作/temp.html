<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>temp</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<script src="jquery-1.11.3.js"></script>
<style>
	.btn{ display: inline-block;width: 60px;line-height: 26px;font-size: 14px;text-align: center;cursor:pointer;border-radius: 4px;border:1px solid rgba(0,0,0,.25);box-shadow: 0 1px rgba(0,0,0,.15), 0 1px rgba(255,255,255,.15);-webkit-user-select: none;overflow: hidden;/* transform:translate3d(0,0,0); */font-family: microsoft yahei; }
	/* .btn:hover{ background-image: linear-gradient(to bottom,rgba(0,0,0,.2) 0%,rgba(0,0,0,.2) 100%); } */
	/* .btn .mask{ position: absolute;width: 130px;height: 130px;border-radius: 50%;background: rgba(0,0,0,.4);opacity: 0; } */
	/* .mask.scale{ transform: scale(0);opacity: 1; } */
</style>
<script>

$.fn.extend({

	'clickSpecial': function(){

		var _this = this;
		//_this.eq(0).get(0) = _this.get(0) = _this[0] = 原生element
		if(!('transition' in _this[0].style)) return;

		_this.on('click',function(e){

			var $self = $(this);
			if($self.find('.maskForSpecialClick').size()==0){
				if($self.css('position')=='static') $self.css('positon','relative');
				$self.css('position','relative').append($('<i>').addClass('maskForSpecialClick'));

				if($('style[class="clickSpecial"]').size()==0){
					var $inteSize = Math.max(this.clientWidth,this.clientHeight)*2.2,
						$style = $('<style class="clickSpecial">').html('.maskForSpecialClick{ position: absolute;width: '+ $inteSize +'px;height: '+ $inteSize +'px;border-radius: 50%;background: rgba(0,0,0,.4);opacity: 0; }.maskForSpecialClick.scale{ transform: scale(0);opacity: 1; }');
					$('head').append($style);
				}
			}
			var $mask = $self.find('.maskForSpecialClick');
			if($mask.get(0).className.indexOf('scale')==-1)
				$mask.css({
					'transition':'0s',
					'left':'200%',
					'top':'200%'
				}).addClass('scale');

			var pos = this.getBoundingClientRect(),
				left = pos.left,
				top = pos.top,
				eX = e.clientX,
				eY = e.clientY;
			var iLeft = eX - left - $mask.get(0).clientWidth/2,
				iTop = eY - top - $mask.get(0).clientHeight/2;
			var timer = null;

			$mask.css({
				'left': iLeft + 'px',
				'top': iTop + 'px'
			});
			clearTimeout(timer);
			timer = setTimeout(function(){

				$mask.css('transition','.6s').removeClass('scale');
			},20)
		})
	}
});

$(function(){

	$('.btn').clickSpecial();
})

// 	window.onload = function(){

// 		var $btn = document.querySelector('.btn'),
// 			$mask = $btn.querySelector('.mask');

// 		$btn.onclick = function(e){

// 			e = e || window.event;
// //隐藏遮罩
// 			var disMask = function(){
// 				$mask.style.transition = '0s';
// 				$mask.style.left = '200%';
// 				$mask.style.left = '200%';
// 				$mask.className = $mask.className.replace(/^\s\s*|\s\s*$/g,'') + ' scale';
// 			};

// 			if($mask.className.indexOf('scale') == -1)
// 				disMask();

// 			var pos = this.getBoundingClientRect(),
// 				left = pos.left,
// 				top = pos.top,
// 				eX = e.clientX,
// 				eY = e.clientY;
// 			var iLeft = eX - left - $mask.clientWidth/2,
// 				iTop = eY - top - $mask.clientHeight/2;
// 			var timer = null;

// 			$mask.style.left = iLeft + 'px';
// 			$mask.style.top = iTop + 'px';

// 			clearTimeout(timer);
// 			timer = setTimeout(function(){

// 				$mask.style.transition = '.6s';
// 				$mask.className = $mask.className.replace(/\b(scale)\b/g,'');
// 			}, 10)
// 		};
// 	};
</script>
</head>
<body>

<span class="btn">button
	<!-- <i class="mask scale"></i> -->
</span>
<span class="btn">buttonBat
	<!-- <i class="mask scale"></i> -->
</span>

<script>
	var formatTpl=function(tpl, stub, data) {

			return tpl.replace(/#\{(.*?)\}/g,function($,$1){

			    if($1 in stub)
			    	if(~Object.prototype.toString.call(stub[$1]).toLowerCase().indexOf('function'))
			    		return stub[$1]();
			    	else
			    		return stub[$1];

		    	return $1 in data ? data[$1] : '';
			})
		},
		tempHtm='<ul>' +
					'<li>#{item}</li>'
				'</ul>'
		,
		data={
			arr:[ 'one','two','three','four','five' ]
		};
	var Html='';
	data.arr.forEach(function(item,index){

		Html+=formatTpl(tempHtm, {
			item : function(){
				return 'This Is '+item;
			}
		},{})
	})
	console.log(Html);
	var Html2='';
	data.arr.forEach(function(item,index){

		Html2+=formatTpl(tempHtm, {}, {
			item: '这里是 '+item
		})
	})
	console.log(Html2)
	// #{ word } 中的word和第二个参数的 key一致 或者与第三个参数的key一直(区别在于第二个参数可以设置为函数然后返回值)
</script>
</body>
</html>